import os, joblib, json, numpy as np, pandas as pd

proj = "/content/drive/MyDrive/streamlit-lbw-app"
os.chdir(proj)

pipeline = joblib.load("model/pipeline.pkl")
preproc = pipeline.named_steps["preproc"]
features = list(pipeline.feature_names_in_)
print("Original features:", len(features))

# Create dummy input
dummy = pd.DataFrame([ [np.nan]*len(features) ], columns=features)

# Transform using preprocessor
X_trans = preproc.transform(dummy)

# Build transformed feature names
transformed = []

# If preprocessor has get_feature_names_out
try:
    transformed = list(preproc.get_feature_names_out())
except:
    # fallback: create manual names
    transformed = [f"feature_{i}" for i in range(X_trans.shape[1])]

print("Transformed feature count:", len(transformed))

# Save to JSON
with open("model/features_transformed.json","w") as f:
    json.dump(transformed, f)

print("Saved updated transformed feature names!")
